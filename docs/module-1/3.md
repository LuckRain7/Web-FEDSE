# 三、DOM/BOM 及事件处理机制

## 1. 浏览器底层渲染机制1.有关样式的处理(37)

![浏览器渲染页面的机制和原理](/images/module-1/3/render.png)



**在页面加载的过程中，如果遇到：**

【link 导入外部样式资源】

浏览器会新开辟一个线程，去服务器获取对应的资源文件（不会阻碍主线程的渲染）

【style 内嵌样式】

正常从上到下解析而已（解析完再继续解析 DOM 结构）

【@import 导入样式】（同步）

此时不会新开辟新的线程与加载资源，而是让主线程去获取，这样阻碍了DOM结构的继续渲染

只有等把外部样式导入进来，并且解析后，才会继续渲染DOM结构。



**优化：**

1.  在真实项目中，如果 CSS 样式代码不是很多（再或者是移动端的项目），我们应该使用内嵌式，以此来减少 HTTP 资源的请求，提高页面渲染的速度。

2.  网络资源请求或者 HTTP 请求的最大并发数：大部分浏览器都维持在 6 个左右（为了避免并发上线，页面渲染速度变慢，我们应该尽量减少 HTTP 的请求数量）



![](/images/module-1/3/1-1.png)

## 2. 浏览器磁层渲染机制2：有关JS的处理(38)

![有关JS的处理](/images/module-1/3/2-1.png)

**页面加载中遇到 JS （JS 中会有操作 DOM 的代码）：** 

【默认 Script src=‘xxx’ 】

主线程会从服务器获取到 JS 资源，并且把 JS 资源进行解析加载，加载完成后继续渲染 DOM 结构

【如果设置了 defer 或者 async】

都是让其编程异步获取资源（不会阻碍 DOM 渲染）

- defer 可以遵循原有的加载顺序，获取后按照顺序去一次渲染 JS
- async 无序的，谁先回来就先执行谁



**优化：**

1. 为啥把 link 写在结构的上面，把 script 写在结构的下面？
   - link 放到顶部是为了更快加载回来css
   - script 放到底部是为了获取 DOM 元素或者不阻碍 DOM 渲染

2. 现代浏览器都有完善的代码扫描机制：如果遇到 script 需要同步加载和渲染代码，浏览器在渲染 JS 的时候，同时会向下继续扫描代码，如果发现一些异步的资源代码，此时就开始加载请求了。

**DOMContentLoaded 事件：**当 DOM 结构加载完成就会触发。

DOM 树有了，并且 JS 也执行加载了，此时触发这个事件。

JQuery 中 $(document).ready(function(){}) | $(function(){})原理就是使用 DOMContentLoaded  事件完成。

DOMContentLoaded 在低版本的额浏览器中不兼容，不兼容则使用 onreadystatechange 事件代替，在这个事件中监听 document.readyState 值，值为 complete 代表 DOM 结构加载完成。

```javascript
window.addEventListener('DOMContentLoaded', _ => {
	let navBox = document.getElementById('navBox');
})
```



**load 事件：**当所有资源都加载完成后才触发。

包含了需要等待图片等资源也加载完才触发。















图潘

/images/module-1/3/2-1.png